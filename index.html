<!doctype html>
<html lang="en" dir="ltr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Group: Private Digital Asset Discussion (Iran)</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/lucide@latest/dist/lucide.min.js"></script>
  <style>
    html,body,#app{height:100%}
    body{font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial}
    .avatar-fallback {
      background: linear-gradient(135deg,#e5e7eb,#f3f4f6);
      display:flex; align-items:center; justify-content:center;
      color:#334155; font-weight:600; text-transform:uppercase;
    }

    /* STATUS (tasteful stimulation) */
    .status-icon-wrap { display:inline-flex; align-items:center; gap:8px; }
    @keyframes blinkPulse {
      0% { opacity: 1; transform: scale(1); }
      50% { opacity: 0.35; transform: scale(1.06); }
      100% { opacity: 1; transform: scale(1); }
    }
    /* apply to the generated svg (we add class 'online-svg' after lucide.replace) */
    .online-svg {
      color: #16a34a; /* green (affects stroke via currentColor) */
      width: 14px;
      height: 14px;
      display:inline-block;
      vertical-align:middle;
      animation: blinkPulse 1.4s infinite ease-in-out;
      transform-origin: 50% 50%;
    }
    /* numeric subtle pulse */
    @keyframes numberPulse {
      0% { transform: translateY(0); opacity: 1; }
      50% { transform: translateY(-1px) scale(1.02); opacity: 0.95; }
      100% { transform: translateY(0); opacity: 1; }
    }
    .status-number { animation: numberPulse 2.2s infinite ease-in-out; color: #065f46; font-weight:700; }

    /* pinned icon svg class applied after replace */
    .pin-svg {
      color: #374151; /* dark slate */
      width: 16px;
      height: 16px;
      vertical-align: -2px;
      margin-right: 6px; /* correct side for LTR */
      display:inline-block;
    }

    /* message visual tweaks */
    .msg-admin { background-color: #f1f5f9; border-left: 4px solid #bfdbfe; padding:12px; border-radius:0.5rem; }
    .msg-mod { background-color: #ffffff; border-left: 4px solid #e5e7eb; padding:12px; border-radius:0.5rem; }
    .msg-system { font-style: italic; color: #6b7280; padding: 8px; }

    img.round-avatar { width:40px; height:40px; border-radius:9999px; object-fit:cover; flex-shrink:0; }

    @media (max-width:640px) {
      .online-svg { width:10px; height:10px; }
      .pin-svg { width:14px; height:14px; margin-right:4px; }
    }
  </style>
</head>
<body class="bg-gray-50 min-h-screen p-4 md:p-8 font-sans">
  <div id="app" class="flex flex-col min-h-screen">
    <header class="flex items-center justify-between mb-4">
      <div>
        <h1 id="group-title" class="text-xl md:text-2xl font-semibold">Group: Private Digital Asset Discussion (Iran)</h1>
        <div class="text-sm text-gray-500 mt-1">
          <strong id="member-approx">Members (visible): ~140</strong> — <span id="date-range">Period: 8 January 2026 — 15 January 2026</span>
        </div>
      </div>

      <div class="flex items-center gap-4">
        <div class="text-right">
          <div class="text-sm font-medium">Status</div>
          <div class="status-icon-wrap" role="status" aria-live="polite" aria-atomic="true">
            <i data-lucide="circle" aria-hidden="true"></i>
            <div id="status-text" class="text-sm text-gray-700">Active now: <span id="status-number" class="status-number">6</span></div>
          </div>
        </div>
      </div>
    </header>

    <main class="flex flex-1 flex-col md:flex-row gap-4">
      <section class="flex-1 flex flex-col bg-white rounded-2xl shadow-sm overflow-hidden">
        <div class="p-4 border-b flex items-start justify-between">
          <div>
            <div class="text-sm font-medium">PINNED CONTENT (always visible)</div>
            <ul id="pinned-list" class="mt-2 text-sm text-gray-700 space-y-1"></ul>
          </div>
          <div class="flex flex-col items-end gap-2">
            <button id="copy-pinned" class="text-xs px-3 py-1 rounded-full border hover:bg-gray-50" aria-label="Copy pinned rules">Copy</button>
            <button id="toggle-notes" class="text-xs px-3 py-1 rounded-full border hover:bg-gray-50" aria-expanded="false">Notes</button>
          </div>
        </div>

        <div id="chat-window" class="p-4 flex-1 overflow-auto" role="log" aria-live="polite">
          <div id="messages-list" class="space-y-3"></div>
        </div>

        <div class="p-4 border-t bg-gray-50">
          <div id="composer-locked" class="flex items-center justify-between gap-4">
            <div class="text-sm text-gray-600">Posting is locked until verification. Please request verification to post.</div>
            <div class="flex gap-2">
              <button id="verify-btn" class="px-3 py-1 rounded bg-blue-600 text-white text-sm">Request verification</button>
            </div>
          </div>

          <div id="composer" class="hidden flex gap-3 items-start">
            <textarea id="composer-text" placeholder="Type a message — Enter to send" class="flex-1 p-3 rounded-lg border resize-none h-16 text-sm" aria-label="Message composer"></textarea>
            <div class="flex flex-col gap-2">
              <button id="send-btn" class="px-4 py-2 rounded bg-green-600 text-white text-sm">Send</button>
            </div>
          </div>
        </div>
      </section>

      <aside class="w-full md:w-72 flex-shrink-0 bg-white rounded-2xl shadow-sm p-4">
        <div class="flex items-center justify-between mb-3">
          <h2 class="text-sm font-semibold">MEMBERS (names)</h2>
          <span class="text-xs text-gray-400">Realistic view</span>
        </div>

        <div id="members-list" class="space-y-2 text-sm text-gray-700"></div>
      </aside>
    </main>

    <div id="behavior-notes" class="mt-4 p-4 bg-white rounded-lg shadow text-sm text-gray-700 hidden">
      <h3 class="font-semibold">REALISTIC CHAT PARTICIPATION (pattern & stats)</h3>
      <pre class="whitespace-pre-wrap">(Overview & instructor notes stored in the script)</pre>
    </div>

    <footer class="mt-4 text-xs text-gray-400">To host on GitHub Pages, save this file as <code>index.html</code> in your repo root (or /docs).</footer>
  </div>

  <script>
    // --- Full data arrays (exact, complete, preserved) ---

    const pinned = [
      "Privacy rules (Iran-focused)",
      "Verification required to participate in sensitive discussions",
      "Group purpose: protect asset value, not investment advice",
      "No screenshots or forwarding",
      "Sensitive questions → DM the admin"
    ];

    const members = [
      "Ariamen Niknam","Zhinos Farmani","Misaq Dashti","Pardis Sohrabi","Pouyan Tarabnia","Zhaleh Pourbakhtiar","Derina Kermani","Sohrab Mehrayin","Sepand Yaghmaei","Bakhtiar Kohandel",
      "Taraneh Rozbehani","Saman Tihu","Padideh Naderi","Niko Foroughi","Hamoon Zagros","Naysabeh Tahmasbi","Diana Siavoshi","Bahman Azarpi","Negin Koneshlu","Rosta Mehrayin",
      "Saman-yar Ahoui","Yara Zhilavand","Parsa Shayeg","Mahraz Golestani","Siamak Hoorami","Helia Mahinpour","Nima Taban","Parvosh Ramyar","Hooshang Bahari","Naghmeh Soroush",
      "Kourosh Nikmanesh","Kian Rudbar","Narges Delaram","Sudeh Kianpour","Amin Shayegan","Niloufar Behrbakhsh","Soha Armaghani","Dara Firoozi","Zhila Mehraban","Samyar Rudgar",
      "Mahrokh Khodadadi","Nava Sayad","Parmida Sahli","Parham Soleimani-Nejad","Sepideh Nikandish","Pegah Derakhshan","Toranj Keyvani","Shahin Pejmanfar","Sheyda Alavi","Hoshmand Kateb",
      "Mojgan Forouhar","Ahura Bahrami","Azadeh Nistani","Farshid Yousefi","Yeganeh Semnani","Siros Padidar","Ainaz Goodarzi","Mani Arashid","Roonak Ghaffari","Radin Sepehri",
      "Mahshad Barghaei","Keyvan Rostami","Nazanin Dehghani","Homa Nadali","Nira Eghbali","Pouyan Kohanzad","Matiah Khoramdel","Baran Jamshidi","Kiarash Mardani","Zaria Farhang",
      "Dihim Nazari","Behnam Alghasi","Golareh Malkani","Koroshian Tarkan","Raha Beheshti","Soheil Nikkhah","Zhaki Zhalehpoor","Rambod Hejri","Shaparak Fallahi","Kamyar Homayounfar",
      "Tarlan Daryabigi","Kimia Khojasteh","Pouya Nasrollahi","Mahyar Farahani","Ladan Soleimani","Niusha Mehraban","Sina Khaleghi","Golsa Shayegan","Abtin Kamali","Farnaz Bahrampour",
      "Mehrangiz Rabiei","Arshan Mahdavi","Yasaman Azarban","Shervin Ganji","Tarnam Mahasti","Arshin Boroumand","Nikzad Shahidi","Bahareh Sirafi","Kikavous Niknami","Mehrnoush Azargun",
      "Parsa Delshad","Zhubin Razaqi","Tahmineh Nikkhah","Houtan Delpak","Roya Danaei","Niloufar Shahryar","Zhyar Kamyab","Mina Salimi","Shayan Mazinani","Diana Farahmand",
      "Arian Mehranfar","Yekta Feyzi","Naderah Pasandideh","Kianoush Damghani","Azadeh Mehrgostar","Samdel Shahrokhi","Mahtab Forouzh","Shayan Nikpour","Koraogh Lilizad","Hamasin Kouhi",
      "Pouyan Zanganeh","Ramin Yarmohammadi","Niloufar Arshidi","Gerard Golchin","Hooman Panjabi","Rana Keyvani","Shahrooz Mehrabi","Minoudokht Bahrami","Adrian Feyzabad","Zarrin Golmohammadi",
      "Farshad Kamkar","Pegah Naderian","Arzu Farozand","Delara Niri","Niko Golrokh","Sepehr Nikrosh","Samaneh Arvand","Yousef Rouzbeh","Mahtab Nobahar","Pedram Shakiba"
    ];

    const seededMessages = [
      { time: "08:57", member: "System", text: "You joined the group.", role: "system" },
      { time: "08:59", member: "System", text: "Online: Tehran, Isfahan, Shiraz, Mashhad (4 people online)", role: "system" },
      { time: "09:02", member: "admin (Naghmeh Soroush)", text: "Welcome. Please read the pinned rules.", role: "admin" },
      { time: "09:11", member: "moderator A (Hooshang Bahari)", text: "For sensitive issues, verification is required. DM the admin.", role: "mod" },
      { time: "09:18", member: "Member (Tehran) — Amin Shayegan", text: "I read the rules.", role: "member" },
      { time: "09:28", member: "System", text: "(Seen) a few members are browsing the pinned items.", role: "system" },
      { time: "09:41", member: "Member (Isfahan) — Sudeh Kianpour", text: "Bank transfers were delayed today.", role: "member" },
      { time: "09:44", member: "moderator B (Parvosh Ramyar)", text: "Please take banking questions to the admin privately.", role: "mod" },
      { time: "10:01", member: "Member (Tehran) — Amin Shayegan", text: "Understood.", role: "member" },
      { time: "12:10", member: "System", text: "Pause — members are reading pinned rules.", role: "system" },
      { time: "15:08", member: "Member (Shiraz) — Niloufar Behrbakhsh", text: "Morning traffic in Tehran was bad.", role: "member" },
      { time: "15:10", member: "Member (Karaj) — Narges Delaram", text: "I saw the same problem.", role: "member" },
      { time: "16:55", member: "System", text: "Pause — new members are quietly browsing.", role: "system" },
      { time: "17:30", member: "System", text: "New member Rosta Mehrayin is viewing the group.", role: "system" },
      { time: "19:12", member: "Member (Mashhad) — Kourosh Nikmanesh", text: "It seems the rial is weaker today.", role: "member" },
      { time: "19:50", member: "admin (Naghmeh Soroush)", text: "Remember to DM for sensitive matters.", role: "admin" },
      { time: "20:05", member: "Member (Shiraz) — Niloufar Behrbakhsh", text: "Just my experience — USDT helped me last week.", role: "member" },
      { time: "21:00", member: "System", text: "Quiet — most members are offline.", role: "system" },

      { time: "08:50", member: "Member (Tehran) — Amin Shayegan", text: "I joined yesterday. Still not verified.", role: "member" },
      { time: "09:15", member: "System", text: "(Scrolling) New member reads some messages from last week.", role: "system" },
      { time: "11:00", member: "admin (Naghmeh Soroush)", text: "The verification queue is nearly full today. Next review window is tomorrow.", role: "admin" },
      { time: "13:15", member: "Member (Isfahan) — Sudeh Kianpour", text: "I was verified yesterday.", role: "member" },
      { time: "13:16", member: "moderator A (Hooshang Bahari)", text: "Welcome — please DM for questions.", role: "mod" },
      { time: "14:12", member: "Member (Karaj) — Kian Rudbar", text: "I’m waiting for verification.", role: "member" },
      { time: "15:00", member: "Member (Mashhad) — Kourosh Nikmanesh", text: "A few who got verified said USDT helped.", role: "member" },
      { time: "16:40", member: "moderator B (Parvosh Ramyar)", text: "Please be patient. Admin reviews in batches.", role: "mod" },
      { time: "18:05", member: "Member (Shiraz) — Niloufar Behrbakhsh", text: "USDT helped me avoid the previous drop.", role: "member" },
      { time: "18:12", member: "Member (Mashhad) — Kourosh Nikmanesh", text: "Me too. Holding some USDT helped.", role: "member" },
      { time: "19:30", member: "System", text: "Relative silence — members mostly reading.", role: "system" },
      { time: "21:12", member: "Member (Karaj) — Kian Rudbar", text: "Still waiting.", role: "member" },

      { time: "18 Dec", member: "Member", text: "Inflation is high. Saving is hard.", role: "member" },
      { time: "25 Dec", member: "moderator A", text: "Reminder — sensitive questions → DM admin.", role: "mod" },
      { time: "30 Dec", member: "Member", text: "Tehran traffic was heavy this week.", role: "member" },
      { time: "01 Jan", member: "admin", text: "Verification process updated. No action required now.", role: "admin" },

      { time: "09:31", member: "Member (Karaj) — Narges Delaram", text: "I got verified. Verification step complete.", role: "member" },
      { time: "09:34", member: "Member (Tehran) — Amin Shayegan", text: "Me too.", role: "member" },
      { time: "10:00", member: "Member (Isfahan) — Sudeh Kianpour", text: "Happy for you.", role: "member" },
      { time: "14:06", member: "admin (Naghmeh Soroush)", text: "Verification window is limited today. Please wait your turn.", role: "admin" },
      { time: "16:21", member: "New member (Isfahan) — Rosta Mehrayin", text: "Any tips to start?", role: "new" },
      { time: "16:24", member: "moderator A (Hooshang Bahari)", text: "Please DM admin for details.", role: "mod" },
      { time: "18:02", member: "Member (Mashhad) — Kourosh Nikmanesh", text: "Bank delays continue.", role: "member" },

      { time: "08:45", member: "Member (Shiraz) — Niloufar Behrbakhsh", text: "Commute was easier today.", role: "member" },
      { time: "09:00", member: "Member (Tehran) — Amin Shayegan", text: "Glad.", role: "member" },
      { time: "10:15", member: "Member (Tehran) — Amin Shayegan", text: "Still waiting for verification.", role: "member" },
      { time: "13:30", member: "moderator B (Parvosh Ramyar)", text: "Reminder: no screenshots or forwarding.", role: "mod" },
      { time: "15:00", member: "Member (Karaj) — Narges Delaram", text: "The verification took a while but arrived.", role: "member" },
      { time: "17:05", member: "Member (Karaj) — Narges Delaram", text: "Rial was slightly more stable today.", role: "member" },

      { time: "09:10", member: "Member (Mashhad) — Kourosh Nikmanesh", text: "I was verified yesterday.", role: "member" },
      { time: "12:55", member: "Member (Tehran) — Amin Shayegan", text: "Morning traffic and rial volatility — nothing new.", role: "member" },
      { time: "15:02", member: "moderator A (Hooshang Bahari)", text: "Sensitive questions → DM admin.", role: "mod" },
      { time: "16:32", member: "Member (Shiraz) — Niloufar Behrbakhsh", text: "Just FYI, I had some USDT.", role: "member" },
      { time: "16:35", member: "Member (Mashhad) — Kourosh Nikmanesh", text: "My experience was similar, just saying.", role: "member" },

      { time: "08:32", member: "Member (Karaj) — Kian Rudbar", text: "Have you seen the bank notice today?", role: "member" },
      { time: "09:10", member: "Member (Mashhad) — Kourosh Nikmanesh", text: "I was verified yesterday.", role: "member" },
      { time: "12:55", member: "Member (Tehran) — Amin Shayegan", text: "No change; delays continue.", role: "member" },
      { time: "14:55", member: "moderator B (Parvosh Ramyar)", text: "Verification is processed in batches; please be patient.", role: "mod" },
      { time: "15:10", member: "New member — Rosta Mehrayin", text: "Thanks. I will wait.", role: "new" },
      { time: "17:10", member: "Member (Tehran) — Amin Shayegan", text: "Personal view: USDT still looks safer.", role: "member" },

      { time: "08:50", member: "Member (Shiraz) — Niloufar Behrbakhsh", text: "It’s warmer here this morning.", role: "member" },
      { time: "09:20", member: "Member (Mashhad) — Kourosh Nikmanesh", text: "Still waiting for admin verification.", role: "member" },
      { time: "10:00", member: "Member (Isfahan) — Sudeh Kianpour", text: "I was verified; everything is normal.", role: "member" },
      { time: "13:40", member: "Member (Mashhad) — Kourosh Nikmanesh", text: "No news. Testing my patience.", role: "member" },
      { time: "14:00", member: "moderator A (Hooshang Bahari)", text: "Please do not post personal contact info publicly.", role: "mod" },
      { time: "15:29", member: "Member (Isfahan) — Sudeh Kianpour", text: "I got verified a few days ago. Nothing special.", role: "member" },
      { time: "17:05", member: "Member (Karaj) — Narges Delaram", text: "Personal experience: USDT helped preserve value.", role: "member" },
      { time: "19:10", member: "System", text: "admin offline — no public post.", role: "system" },

      { time: "09:05", member: "System", text: "3–6 people were online in the morning.", role: "system" },
      { time: "10:12", member: "Member (Shiraz) — Niloufar Behrbakhsh", text: "Tehran is warmer than last week.", role: "member" },
      { time: "11:00", member: "admin (Naghmeh Soroush)", text: "Verification queue updated; if you applied in the past 72 hours, check your DM.", role: "admin" },
      { time: "13:40", member: "Member (Mashhad) — Kourosh Nikmanesh", text: "Still waiting. My patience is being tested.", role: "member" },
      { time: "14:30", member: "moderator B (Parvosh Ramyar)", text: "Reminder: privacy is important. No screenshots or forwarding.", role: "mod" },
      { time: "17:02", member: "moderator A (Hooshang Bahari)", text: "Please DM sensitive banking questions.", role: "mod" },
      { time: "18:30", member: "Member (Karaj) — Narges Delaram", text: "A few people got verified, no big news. Calm.", role: "member" },
      { time: "20:05", member: "Member (Karaj) — Narges Delaram", text: "My USDT mention is personal experience. Not advice.", role: "member" }
    ];

    // Avatar token list and helpers
    const femaleTokens = [
      "zhaleh","derina","taraneh","padideh","niko","naysabeh","diana","negin","yara","narges",
      "sudeh","niloufar","pegah","shaparak","mina","roonak","zaria","mojgan","azadeh","yasaman",
      "delara","bahareh","mehrnoush","zarrin","mahtab","niusha","golsa","yekta","nazanin","homa",
      "farah","parida","parisa","soheila","zahra","fatemeh","marjan","sara","roxana","rosta"
    ];

    function looksFemale(name){
      if(!name) return false;
      const lower = name.toLowerCase();
      return femaleTokens.some(t => lower.includes(t));
    }
    function randInt(max){ return Math.floor(Math.random()*max); }

    const memberProfiles = members.map((name) => {
      const hasAvatar = Math.random() < 0.6;
      const genderFolder = looksFemale(name) ? "women" : "men";
      const avatarIndex = randInt(100);
      return {
        name,
        avatar: hasAvatar ? `https://randomuser.me/api/portraits/${genderFolder}/${avatarIndex}.jpg` : null,
        gender: looksFemale(name) ? "female" : "male"
      };
    });

    // DOM refs
    const pinnedList = document.getElementById("pinned-list");
    const messagesList = document.getElementById("messages-list");
    const copyPinnedBtn = document.getElementById("copy-pinned");
    const toggleNotesBtn = document.getElementById("toggle-notes");
    const behaviorNotes = document.getElementById("behavior-notes");
    const verifyBtn = document.getElementById("verify-btn");
    const composerLocked = document.getElementById("composer-locked");
    const composer = document.getElementById("composer");
    const composerText = document.getElementById("composer-text");
    const sendBtn = document.getElementById("send-btn");
    const chatWindow = document.getElementById("chat-window");
    const statusNumberEl = document.getElementById("status-number");
    const membersListEl = document.getElementById("members-list");

    function renderPinned(){
      pinnedList.innerHTML = "";
      pinned.forEach(p=>{
        const li = document.createElement("li");
        li.className = "leading-snug flex items-center";
        const icon = document.createElement("i");
        icon.setAttribute("data-lucide","pin");
        icon.setAttribute("aria-hidden","true");
        li.appendChild(icon);
        const span = document.createElement("span");
        span.textContent = p;
        li.appendChild(span);
        pinnedList.appendChild(li);
      });
    }

    function createFallbackElement(name){
      const fallback = document.createElement("div");
      fallback.className = "h-10 w-10 rounded-full avatar-fallback text-xs flex-shrink-0";
      const initials = (name || "").split(" ").map(s => s[0]).slice(0,2).join("") || "M";
      fallback.textContent = initials;
      return fallback;
    }

    function renderMembers(){
      membersListEl.innerHTML = "";
      memberProfiles.forEach(m=>{
        const row = document.createElement("div");
        row.className = "flex items-center gap-3";
        if(m.avatar){
          const img = document.createElement("img");
          img.src = m.avatar;
          img.alt = m.name;
          img.className = "round-avatar";
          img.onerror = () => { img.remove(); row.insertBefore(createFallbackElement(m.name), row.firstChild || null); };
          row.appendChild(img);
        } else {
          row.appendChild(createFallbackElement(m.name));
        }
        const nameDiv = document.createElement("div");
        nameDiv.className = "text-sm";
        nameDiv.textContent = m.name;
        row.appendChild(nameDiv);
        membersListEl.appendChild(row);
      });
    }

    function renderMessages(){
      messagesList.innerHTML = "";
      seededMessages.forEach(m=>{
        const article = document.createElement("article");
        if(m.role === "system"){
          article.className = "msg-system";
          article.textContent = `${m.time} ${m.text}`;
        } else {
          article.className = m.role === "admin" ? "msg-admin" : m.role === "mod" ? "msg-mod" : "p-3 rounded-lg bg-gray-50";
          const header = document.createElement("div");
          header.className = "flex items-center justify-between";
          const left = document.createElement("div");
          left.className = "flex items-center gap-3";
          const profile = memberProfiles.find(p => m.member && p.name && m.member.includes(p.name));
          if(profile && profile.avatar){
            const img = document.createElement("img");
            img.src = profile.avatar;
            img.alt = profile.name;
            img.className = "round-avatar";
            img.onerror = () => { img.remove(); left.insertBefore(createFallbackElement(profile.name), left.firstChild || null); };
            left.appendChild(img);
          } else {
            left.appendChild(createFallbackElement(m.member));
          }
          const nameDiv = document.createElement("div");
          nameDiv.className = "text-sm font-medium";
          nameDiv.textContent = m.member || "Member";
          left.appendChild(nameDiv);
          header.appendChild(left);
          const time = document.createElement("div");
          time.className = "text-xs text-gray-400";
          time.textContent = m.time;
          header.appendChild(time);
          const p = document.createElement("p");
          p.className = "mt-2 text-sm text-gray-700";
          p.textContent = m.text;
          article.appendChild(header);
          article.appendChild(p);
        }
        messagesList.appendChild(article);
      });
      chatWindow.scrollTop = chatWindow.scrollHeight;
    }

    copyPinnedBtn.addEventListener("click", async () => {
      try { await navigator.clipboard.writeText(pinned.join("\n")); alert("Pinned rules copied to clipboard"); }
      catch(e) { console.warn("copy failed", e); alert("Unable to copy"); }
    });

    toggleNotesBtn.addEventListener("click", () => {
      const isHidden = behaviorNotes.classList.contains("hidden");
      behaviorNotes.classList.toggle("hidden");
      toggleNotesBtn.setAttribute("aria-expanded", String(!isHidden));
    });

    verifyBtn.addEventListener("click", () => {
      composerLocked.classList.add("hidden");
      composer.classList.remove("hidden");
      composerText.focus();
    });

    sendBtn.addEventListener("click", () => {
      const txt = composerText.value.trim();
      if(!txt) return;
      const now = new Date();
      const timeStr = now.toLocaleTimeString([], { hour: "2-digit", minute: "2-digit" });
      seededMessages.push({ time: timeStr, member: "You", text: txt, role: "member" });
      composerText.value = "";
      renderMessages();
    });

    composerText.addEventListener("keydown", (e) => {
      if(e.key === "Enter" && !e.shiftKey){ e.preventDefault(); sendBtn.click(); }
    });

    function updateStatusNumber(){
      const val = 3 + Math.floor(Math.random()*6); // 3..8
      statusNumberEl.textContent = val;
    }

    function wireLucideSvgs(){
      if(window.lucide && typeof lucide.replace === "function"){
        lucide.replace();
        document.querySelectorAll("svg.lucide-circle").forEach(svg => svg.classList.add("online-svg"));
        document.querySelectorAll("svg.lucide-pin").forEach(svg => svg.classList.add("pin-svg"));
      }
    }

    function init(){
      renderPinned();
      renderMembers();
      renderMessages();
      updateStatusNumber();
      wireLucideSvgs();
      setInterval(updateStatusNumber, 5000 + Math.floor(Math.random()*7000));
    }

    init();
  </script>
</body>
</html>
