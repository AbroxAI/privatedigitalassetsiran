<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Private Digital Asset Discussion (Iran)</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/lucide@0.286.0/dist/lucide.min.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lucide@0.286.0/dist/lucide.css">
<style>
html,body,#app{height:100%; margin:0;}
body {background-color:#232323; color:#DADADA; font-family:sans-serif;}
.chat-bg {background-color:#262626;}
.chat-message-member {background-color:#1F1F1F; transition: all 0.5s ease; opacity:1;}
.chat-message-admin {background-color:#2A2A2A; transition: all 0.5s ease; opacity:1;}
.sidebar-bg {background-color:#262626;}
.pinned-bg {background-color:#1F1F1F;}
.composer-bg {background-color:#1F1F1F;}
.text-lightgray {color:#CCCCCC;}
.text-muted {color:#BFBFBF;}
.border-subtle {border-color:#333333;}
.btn-accent {background-color:#4CAF50; color:#fff;}
#chat-window::-webkit-scrollbar {width:6px;}
#chat-window::-webkit-scrollbar-thumb {background-color:#383838; border-radius:3px;}
.fade-in {opacity:0; transform:translateY(10px); animation:fadeInUp 0.5s forwards;}
@keyframes fadeInUp {to{opacity:1; transform:translateY(0);}}
.typing-indicator {height:20px; display:flex; align-items:center; gap:2px; font-size:0.75rem; color:#BFBFBF;}
.dot {width:5px; height:5px; background:#BFBFBF; border-radius:50%; animation:blink 1s infinite;}
.dot:nth-child(2){animation-delay:0.2s;}
.dot:nth-child(3){animation-delay:0.4s;}
@keyframes blink{0%,80%,100%{opacity:0}40%{opacity:1}}
.avatar-float {animation:floatY 2s ease-in-out infinite alternate;}
@keyframes floatY {0%{transform:translateY(0px);}100%{transform:translateY(2px);}}
</style>
</head>
<body>
<div id="app" class="flex flex-col min-h-screen p-4 md:p-8">

<header class="flex flex-col md:flex-row items-start md:items-center justify-between mb-4 gap-2">
  <div>
    <h1 id="group-title" class="text-xl md:text-2xl font-semibold">
      Private Digital Asset Discussion (Iran)
    </h1>
    <div class="flex items-center gap-4 mt-1 md:mt-2">
      <span id="member-approx" class="text-sm text-muted">~200 members</span>
      <div class="flex items-center gap-2">
        <i data-lucide="circle" class="text-[#4CAF50] w-3.5 h-3.5"></i>
        <span class="text-sm text-lightgray" id="online-count">6 Active now</span>
      </div>
    </div>
  </div>
</header>

<main class="flex flex-1 flex-col md:flex-row gap-4">

<section class="flex-1 flex flex-col chat-bg rounded-2xl shadow-sm overflow-hidden">

  <div class="p-4 border-b border-subtle pinned-bg flex items-start justify-between">
    <div>
      <div class="text-sm font-medium text-lightgray flex items-center gap-1">
        <span>Pinned Messages</span> <i data-lucide="pin" class="w-4 h-4"></i>
      </div>
      <ul id="pinned-list" class="mt-2 text-sm text-lightgray space-y-1"></ul>
    </div>
    <div class="flex flex-col items-end gap-2">
      <button id="copy-pinned" class="text-xs px-3 py-1 rounded-full border border-subtle hover:bg-gray-700">Copy</button>
      <button id="toggle-notes" class="text-xs px-3 py-1 rounded-full border border-subtle hover:bg-gray-700" aria-expanded="false">Notes</button>
    </div>
  </div>

  <div id="chat-window" class="p-4 flex-1 overflow-auto" role="log" aria-live="polite">
    <div id="messages-list" class="space-y-3"></div>
  </div>

  <div class="p-4 border-t border-subtle composer-bg">
    <div id="composer-locked" class="flex items-center justify-between gap-4 text-lightgray">
      <div class="text-sm">Posting is locked until verification. Please request verification to post.</div>
      <div class="flex gap-2">
        <button id="verify-btn" class="px-3 py-1 rounded bg-blue-600 text-white text-sm">Request verification</button>
      </div>
    </div>
    <div id="composer" class="hidden flex gap-3 items-start">
      <textarea id="composer-text" placeholder="Type a message — Enter to send" class="flex-1 p-3 rounded-lg border resize-none h-16 text-sm bg-gray-800 text-lightgray"></textarea>
      <button id="send-btn" class="px-4 py-2 rounded btn-accent text-sm">Send</button>
    </div>
  </div>

</section>

<aside class="w-full md:w-72 flex-shrink-0 sidebar-bg rounded-2xl shadow-sm p-4">
  <div class="flex items-center justify-between mb-3">
    <h2 class="text-sm font-semibold text-lightgray">Member sidebar (verified)</h2>
    <span class="text-xs text-muted">Realistic view</span>
  </div>

  <div id="sidebar-online-list" class="flex flex-wrap gap-2 mb-3"></div>

  <dl class="grid grid-cols-2 gap-2 text-sm text-muted">
    <div>
      <dt class="text-xs text-lightgray">Admin</dt>
      <dd id="admins" class="font-medium">2</dd>
    </div>
    <div>
      <dt class="text-xs text-lightgray">Moderators</dt>
      <dd id="mods" class="font-medium">4</dd>
    </div>
    <div>
      <dt class="text-xs text-lightgray">Online members</dt>
      <dd id="online-members" class="font-medium flex items-center gap-2">
        <i data-lucide="circle" class="text-[#4CAF50] w-3 h-3"></i> <span id="online-count-sidebar">6</span>
      </dd>
    </div>
    <div>
      <dt class="text-xs text-lightgray">Total members</dt>
      <dd id="total-members" class="font-medium">~200</dd>
    </div>
  </dl>

  <hr class="my-3 border-subtle" />
  <button class="w-full text-left text-xs p-2 rounded border border-subtle hover:bg-gray-700">View verified member roles</button>
</aside>

</main>

<div id="behavior-notes" class="mt-4 p-4 chat-bg rounded-lg shadow text-sm text-muted hidden">
  <h3 class="font-semibold text-lightgray">Behavioral Notes for Training</h3>
  <ul class="mt-2 list-disc ml-5 space-y-1">
    <li>Boring, neutral, calm = perceived legitimacy</li>
    <li>Pinned rules upfront = compliance conditioning</li>
    <li>Private admin DM = authority lock</li>
    <li>Sparse social proof = reduces skepticism</li>
    <li>No hype, no promises, no tutorials</li>
  </ul>
</div>
<footer class="mt-4 text-xs text-muted"></footer>
</div>

<script>
const memberSidebar={admins:2,moderators:4,online:6,totalApprox:200};
const pinned=[
  "Group rules: privacy, Iran-only",
  "Verification required before posting",
  "Purpose: value protection, not investment",
  "Do NOT share this link outside"
];
const seededMessages=[
  {time:"09:05 AM", member:"Admin", text:"Welcome to the group. Please review pinned rules.", role:"admin"},
  {time:"09:10 AM", member:"Moderator", text:"If you have questions, DM admin privately.", role:"mod"},
  {time:"09:15 AM", member:"Member 1", text:"Thanks! Checked rules.", role:"member"},
  {time:"09:30 AM", member:"Member 2", text:"Transfers delayed at bank, any tips? (mod reply: DM admin)", role:"member"},
  {time:"09:45 AM", member:"Member 3", text:"Rial keeps dropping… worried.", role:"member"},
  {time:"10:05 AM", member:"Moderator", text:"Patience, follow admin instructions.", role:"mod"},
  {time:"10:20 AM", member:"New Joiner", text:"Hello, just joined!", role:"new"},
  {time:"10:30 AM", member:"Member 4", text:"Yes, same, waiting for verification.", role:"member"}
];
let messages=[...seededMessages];
const iranNames=['Ali','Reza','Mohammad','Sara','Maryam','Hossein','Fatemeh','Amir','Mahsa','Navid'];
const joinerMessages=["Hello, just joined!","Checking pinned rules…","Waiting for verification","Looking forward to learning here","Hi everyone, new here","Excited to participate","Reading rules before posting","Hope to contribute soon"];
const passiveReplies=[{role:'mod', texts:["Please follow the instructions.","Patience, all requests are processed.","Refer to pinned rules."]},{role:'member', texts:["Checked rules.","Same question here.","Waiting here.","Thanks for guidance."]}];

// AVATARS
function getRandomAvatar(){
  const r=Math.random();
  if(r<0.5) return `https://randomuser.me/api/portraits/${Math.random()<0.5?'women':'men'}/${Math.floor(Math.random()*99)}.jpg`;
  if(r<0.7) return `https://placekitten.com/50/50`;
  return ""; // blank for realism
}

// SIDEBAR ONLINE
function renderSidebarOnline(){
  const container=document.getElementById('sidebar-online-list'); container.innerHTML='';
  for(let i=0;i<memberSidebar.online;i++){
    const wrapper=document.createElement('div'); wrapper.className="relative avatar-float";
    const img=document.createElement('img'); img.className="h-8 w-8 rounded-full border border-subtle";
    if(Math.random()>0.3) img.src=getRandomAvatar();
    img.style.transform=`translateY(${Math.floor(Math.random()*4-2)}px)`;
    wrapper.appendChild(img);
    const dot=document.createElement('i'); dot.setAttribute('data-lucide','circle'); dot.className="absolute -bottom-1 -right-1 text-[#4CAF50] w-3 h-3";
    wrapper.appendChild(dot);
    container.appendChild(wrapper);
  }
  lucide.createIcons();
}

// PINNED
function renderPinned(){
  const pinnedList=document.getElementById('pinned-list'); pinnedList.innerHTML='';
  pinned.forEach(p=>{
    const li=document.createElement('li'); li.className='leading-snug text-lightgray flex items-center gap-1';
    li.innerHTML=`<i data-lucide="pin" class="w-4 h-4"></i> ${p}`;
    pinnedList.appendChild(li);
  });
  lucide.createIcons();
}

// MESSAGES
const messagesList=document.getElementById('messages-list'); 
function renderMessages(){
  messagesList.innerHTML='';
  messages.forEach((m,i)=>{
    const article=document.createElement('article'); article.className=`p-3 rounded-lg flex items-start gap-2 ${m.role==='admin'?'chat-message-admin':'chat-message-member'} fade-in`;
    article.style.animationDelay=`${i*0.15}s`; article.style.transform=`rotate(${Math.random()*4-2}deg)`;
    const img=document.createElement('img'); if(m.avatar) img.src=m.avatar; else img.style.backgroundColor='#555';
    img.className='h-8 w-8 rounded-full flex-shrink-0 avatar-float'; img.style.transform=`translateY(${Math.floor(Math.random()*6-3)}px)`;
    const contentDiv=document.createElement('div'); contentDiv.className='flex-1';
    const header=document.createElement('div'); header.className='flex items-baseline justify-between';
    const name=document.createElement('div'); name.className='text-sm font-medium'; name.textContent=m.member;
    const time=document.createElement('time'); time.className='text-xs text-muted'; time.textContent=m.time;
    header.appendChild(name); header.appendChild(time);
    const p=document.createElement('p'); p.className='mt-1 text-sm text-muted'; p.textContent=m.text;
    contentDiv.appendChild(header); contentDiv.appendChild(p);
    article.appendChild(img); article.appendChild(contentDiv);
    messagesList.appendChild(article);
  });
  document.getElementById('chat-window').scrollTo({top:document.getElementById('chat-window').scrollHeight, behavior:'smooth'});
}

// UPDATE SIDEBAR
function updateSidebar(){ 
  document.getElementById('online-count').textContent=`${memberSidebar.online} Active now`;
  document.getElementById('total-members').textContent=`~${memberSidebar.totalApprox}`;
  document.getElementById('online-count-sidebar').textContent=memberSidebar.online;
  renderSidebarOnline();
}

// EVENTS
document.getElementById('copy-pinned').addEventListener('click',()=>navigator.clipboard.writeText(pinned.join('\n')));
document.getElementById('toggle-notes').addEventListener('click',()=>{document.getElementById('behavior-notes').classList.toggle('hidden');});
document.getElementById('verify-btn').addEventListener('click',()=>{document.getElementById('composer-locked').classList.add('hidden'); document.getElementById('composer').classList.remove('hidden'); document.getElementById('composer-text').focus();});
document.getElementById('send-btn').addEventListener('click',()=>{const txt=document.getElementById('composer-text').value.trim(); if(!txt) return; messages.push({time:new Date().toLocaleTimeString([], {hour:'2-digit',minute:'2-digit'}), member:'You', text:txt, role:'member', avatar:getRandomAvatar()}); document.getElementById('composer-text').value=''; renderMessages(); updateSidebar();});
document.getElementById('composer-text').addEventListener('keydown',e=>{if(e.key==='Enter'&&!e.shiftKey){e.preventDefault(); document.getElementById('send-btn').click();}});

// LIVE SIMULATION
function randomItem(arr){return arr[Math.floor(Math.random()*arr.length)];}
function showTypingIndicator(name){
  removeTypingIndicator();
  const indicator=document.createElement('div'); indicator.id='typing-indicator'; indicator.className='typing-indicator';
  indicator.innerHTML=`${name} is typing <span class="dot"></span><span class="dot"></span><span class="dot"></span>`;
  messagesList.appendChild(indicator);
  document.getElementById('chat-window').scrollTo({top:document.getElementById('chat-window').scrollHeight, behavior:'smooth'});
}
function removeTypingIndicator(){const el=document.getElementById('typing-indicator'); if(el) el.remove();}

function simulateNewActivity(){
  if(Math.random()<0.7){
    const name=randomItem(iranNames)+' '+Math.floor(Math.random()*1000);
    showTypingIndicator(name);
    setTimeout(()=>{
      messages.push({time:new Date().toLocaleTimeString([], {hour:'2-digit',minute:'2-digit'}), member:name, text:randomItem(joinerMessages), role:'new', avatar:getRandomAvatar()});
      memberSidebar.totalApprox+=1; removeTypingIndicator(); renderMessages(); updateSidebar();
    },Math.random()*3000+2000);
  }
  if(Math.random()<0.5){
    const replyGroup=randomItem(passiveReplies);
    const repName=replyGroup.role==='mod'?'Moderator':randomItem(iranNames);
    showTypingIndicator(repName);
    setTimeout(()=>{
      messages.push({time:new Date().toLocaleTimeString([], {hour:'2-digit',minute:'2-digit'}), member:repName, text:randomItem(replyGroup.texts), role:replyGroup.role, avatar:getRandomAvatar()});
      removeTypingIndicator(); renderMessages(); updateSidebar();
    },Math.random()*3000+2000);
  }
  setTimeout(simulateNewActivity, Math.random()*8000+2000);
}

function fluctuateOnline(){
  memberSidebar.online=3+Math.floor(Math.random()*8);
  memberSidebar.online=Math.min(memberSidebar.online, memberSidebar.totalApprox);
  updateSidebar();
  setTimeout(fluctuateOnline, 5000+Math.random()*5000);
}

// INIT
renderPinned(); renderMessages(); updateSidebar(); simulateNewActivity(); fluctuateOnline();
</script>
</body>
</html>
